<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Banderas y paÃ­ses</title>

  <!-- Enlace al CSS externo -->
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="app">
    <h1>ğŸš© Banderas y paÃ­ses</h1>
    <div class="row">
      <div class="pill">Puntos: <b id="score">0</b></div>
      <div class="pill">Ronda: <b id="round">1</b>/<b id="total">10</b></div>
    </div>

    <div class="question">Â¿A quÃ© paÃ­s pertenece esta bandera?</div>

    <div class="flagBox">
      <img id="flag" class="flag" src="" alt="Bandera">
    </div>

    <div id="answers" class="ans"></div>

    <div class="row actions">
      <button id="next" class="next" disabled>Siguiente â­</button>
    </div>
  </div>

  <script>
  const $ = s => document.querySelector(s);
  const $$ = s => Array.from(document.querySelectorAll(s));

  let ALL = [];
  let state = {score:0, round:1, total:10, current:null, locked:false};

  function pick(arr, n=1){
    const a=[...arr]; const out=[];
    while(out.length<n && a.length){ out.push(a.splice(Math.floor(Math.random()*a.length),1)[0]); }
    return out;
  }

  async function loadCountries(){
    const res = await fetch('https://restcountries.com/v3.1/all?fields=name,flags');
    const data = await res.json();
    ALL = data
      .filter(c => c?.name?.common && (c.flags?.svg || c.flags?.png))
      .map(c => ({ name: c.name.common, flag: c.flags.svg || c.flags.png }));
  }

  function renderOptions(correctName, pool){
    const names = pool.map(x=>x.name);
    if(!names.includes(correctName)) names.splice(Math.floor(Math.random()*names.length), 0, correctName);
    const opts = [...new Set(names)].slice(0,4).sort(()=>Math.random()-0.5);
    const box = $('#answers'); box.innerHTML = '';
    opts.forEach(name=>{
      const btn = document.createElement('button');
      btn.className = 'btn';
      btn.textContent = name;
      btn.onclick = ()=> choose(name);
      box.appendChild(btn);
    });
  }

  function lock(selected){
    state.locked = true;
    const correct = state.current.correct;
    $$('#answers .btn').forEach(b=>{
      if(b.textContent === correct) b.classList.add('correct');
      if(selected && b.textContent === selected && selected !== correct) b.classList.add('wrong');
      b.disabled = true;
    });
    $('#next').disabled = false;
  }

  function choose(name){
    if(state.locked) return;
    if(name === state.current.correct){
      state.score++;
      $('#score').textContent = state.score;
    }
    lock(name);
  }

  async function nextRound(){
    $('#next').disabled = true;
    state.locked = false;
    if(state.round > state.total){
      endGame();
      return;
    }

    const sample = pick(ALL, 4);
    if(sample.length < 4) return;

    const [correct, ...others] = sample;
    state.current = { correct: correct.name };
    $('#flag').src = correct.flag;
    renderOptions(correct.name, others);

    $('#round').textContent = state.round;
  }

  // --- Manejo de los botones y fin del juego ---
  $('#next').addEventListener('click', ()=>{
    state.round++;
    if(state.round <= state.total) {
      nextRound();
    } else {
      endGame();
    }
  });

  function endGame(){
    const app = $('.app');
    app.innerHTML = `
      <h1>ğŸ Juego terminado</h1>
      <p class="final-score">Tu puntaje final fue <b>${state.score}</b> de <b>${state.total}</b></p>
      <button class="restart">ğŸ”„ Volver a empezar</button>
    `;

    $('.restart').addEventListener('click', restartGame);
  }

  function restartGame(){
    state = {score:0, round:1, total:10, current:null, locked:false};
    location.reload();
  }

  // init
  (async function init(){
    await loadCountries();
    nextRound();
  })();
  </script>
</body>
</html>
